---
title: '【硬核干货】黑客视角的预判：手把手教你做 IoT 威胁建模'
date: '2025-12-28'
tags: ['IoT Security']
draft: false
summary: '在拿起螺丝刀和键盘之前，黑客都在想什么？本文通过一个医疗输液泵的实战案例，教你如何用 STRIDE 模型和攻击树把设备扒得底裤都不剩。'
---

你是否想过，真正的高手在攻击一台设备前，脑子里在想什么？是直接拿起键盘敲代码，还是拿起烙铁焊电路？
不，真正的高手是**谋定而后动**。

在安全领域，这个过程叫做**威胁建模（Threat Modeling）**。它不仅仅是找出漏洞，而是一个系统性地识别潜在攻击、评估严重程度并制定防御策略的过程。对于 IoT（物联网）设备来说，由于其特殊的硬件限制和运行环境，威胁建模显得尤为重要。

今天，我们就基于《Practical IoT Hacking》第二章的核心内容，带你通过一个**医疗药物输液泵**的实战案例，彻底掌握 IoT 威胁建模的精髓。

## 一、 为什么 IoT 设备总是“先天不足”？

在开始建模之前，我们需要理解 IoT 世界的特殊性。为什么我们不能直接套用保护 PC 或服务器的方法？书里一针见血地指出了原因：

1.  **硬件大杂烩**：很多 IoT 设备本质上就是魔改的 Android 手机、平板，甚至是树莓派。为了省钱和省电，它们的 CPU 弱、内存小、存储空间捉襟见肘。
2.  **裸奔的系统**：因为资源有限，这些设备通常跑不动杀毒软件、白名单控制或网络准入控制（NAC）。
3.  **拼凑的生态**：很多厂商使用“白标”（White-label）模式，贴个牌就卖。这意味着底层的软件和硬件可能来自无数个上游供应商，导致漏洞修复极其困难。
4.  **物理环境恶劣**：不像服务器锁在空调房里，IoT 设备通常部署在你可以直接接触到的地方（比如你的床头、医院走廊或街道上），这给了攻击者物理接触的机会。

## 二、 我们的武器：STRIDE 威胁模型

我们要用什么框架来分析威胁呢？业界最经典、最好用的工具莫过于微软开发的 **STRIDE** 模型。记住这六个字母，它们代表了六种核心威胁：

| 缩写  | 英文全称                   | 中文名称      | 攻击者在做什么？           | 例子                         |
| :---- | :------------------------- | :------------ | :------------------------- | :--------------------------- |
| **S** | **Spoofing**               | **欺骗/伪造** | 假装成系统的一个组件或用户 | 我假装是护士登录系统         |
| **T** | **Tampering**              | **篡改**      | 修改数据或系统的完整性     | 把药量从 10ml 改成 100ml     |
| **R** | **Repudiation**            | **抵赖**      | 用户否认做过某事           | 删掉日志，让你查不到是谁干的 |
| **I** | **Information Disclosure** | **信息泄露**  | 偷看机密数据               | 窃取病人病历或设备密钥       |
| **D** | **Denial of Service**      | **拒绝服务**  | 让系统不可用               | 断电、干扰无线信号           |
| **E** | **Elevation of Privilege** | **权限提升**  | 获得不该有的权限           | 从普通用户变成 Root 管理员   |

## 三、 实战演练：解剖“智能药物输液泵”

为了演示如何做威胁建模，我们假设我们要评估一套**智能药物输液泵系统**。这可是人命关天的设备，容不得半点马虎。

### 第一步：画出架构图 (Architecture)

首先，我们要搞清楚这个系统长什么样。

<img
  src="/static/images/IOT/infusion_pump_architecture1.png"
  alt="Figure 2-1 & 2-2: 输液泵系统的基础架构与扩展架构"
  width="700"
/>
<img
  src="/static/images/IOT/infusion_pump_architecture2.png"
  alt="Figure 2-1 & 2-2: 输液泵系统的基础架构与扩展架构"
  width="700"
/>
*(图注：我们可以看到系统不仅仅是一个泵，它包括药物输液泵、控制服务器、电子病历系统(EHR)以及更新服务器。)*

### 第二步：拆解组件 (Decomposition)

光看大框是不够的，我们需要像剥洋葱一样拆解它。控制服务器里有什么？输液泵里跑着什么？

<img
  src="/static/images/IOT/threat_model_breakdown.png"
  alt="Figure 2-3: Breaking down our threat model further"
  width="700"
/>
*(图注：详细组件拆解。我们看到了限制性用户界面(RUI)、操作系统、固件、药物数据库等核心部件。)*

核心组件包括：

1.  **限制性用户界面 (RUI)**：类似银行 ATM 的全屏应用，护士操作界面。
2.  **控制服务器服务**：后台的大脑。
3.  **药物数据库 (Drug Library)**：存着各种药的配方。
4.  **操作系统 (OS)**：底层的 Linux 或 Android。
5.  **固件 (Firmware)**：驱动硬件的代码。
6.  **物理设备**：看得见摸得着的铁盒子。

### 第三步：划定信任边界 (Trust Boundaries)

这是最关键的一步。我们需要画出数据流向，并圈出哪些部分是“自己人”（可信），哪些是“外人”（不可信）。

<img
  src="/static/images/IOT/trust_boundaries.png"
  alt="Figure 2-4: Diagram with trust boundaries included"
  width="700"
/>
*(图注：虚线框代表信任边界。跨越边界的数据流（比如从病人到设备，从设备到外部更新服务器）就是最危险的地方，也是黑客最喜欢利用的入口。)*

---

## 四、 全面入侵：用 STRIDE 扫描每一个组件

现在，我们戴上黑客的帽子，针对每一个组件，逐一应用 STRIDE 模型。这是本章最精彩的部分。

### 1. 限制性用户界面 (The Restrictive User Interface - RUI)

这是护士看到的屏幕界面，就像一个 Kiosk 模式的 App。

- **S (欺骗)**：登录机制弱吗？如果是简单的 4 位 PIN 码，攻击者很容易猜到，然后假装护士操作。
- **T (篡改)**：虽然是全屏模式，但如果插入外接键盘按 `Alt+F4` 能关掉程序吗？能调出任务管理器吗？一旦绕过界面，就能修改系统配置。
- **R (抵赖)**：如果为了方便，所有护士都共用一个账号“Nurse”，出了医疗事故谁负责？没有独立的账号审计就是给抵赖留后门。
- **I (泄露)**：界面报错时会不会弹出调试信息？比如“数据库连接失败，连接字符串是 `user:admin, pass:123456`”？
- **D (DoS)**：如果有“输错 5 次密码锁定 30 分钟”的机制，攻击者可以故意输错，导致急救时护士无法登录，间接杀人。

### 2. 控制服务器服务 (The Control Server Service)

这是后台处理逻辑的核心程序。

- **S (欺骗)**：**侧录攻击 (Skimming)**。如果攻击者把输液泵换成了被篡改过的设备，服务器能识别吗？它验证设备身份了吗？
- **T (篡改)**：**中间人攻击 (MITM)**。攻击者卡在服务器和泵之间，把“注射 10ml”改成“注射 100ml”。通信必须校验完整性。
- **R (抵赖)**：日志文件是不是谁都能写？攻击者能不能删掉日志来掩盖入侵？
- **D (DoS)**：**信号干扰**。在服务器旁边开一个大功率干扰器，切断它和泵的无线连接。
- **E (提权)**：API 接口是否有漏洞？普通用户能不能调用管理员的 API？

### 3. 药物数据库 (The Drug Library)

存储救命药方和用户数据的地方。

- **T (篡改)**：**SQL 注入**。如果在输入框输入 `' OR 1=1 --`，能不能删库或者修改药物剂量？
- **I (泄露)**：**盲注 SQL**。攻击者可以通过构造特殊的查询（Out-of-band SQLi），一点点把数据库里的敏感数据“骗”到自己的服务器上。
- **E (提权)**：数据库服务是不是以 root/admin 权限运行的？如果是，攻破数据库就等于攻破了整台机器。

### 4. 操作系统 (The Operating System)

底层的基础设施，通常是 Linux 或 Android。

- **S (欺骗)**：能不能从 U 盘启动一个恶意的 Linux 系统？
- **T (篡改)**：能不能修改防火墙规则？能不能植入后门木马？
- **I (泄露)**：**侧信道攻击 (Side-channel)**。通过分析 CPU 的电磁波或功耗，推算出加密密钥。
- **D (DoS)**：触发系统崩溃或故意让服务重启。
- **E (提权)**：利用内核漏洞（如 Dirty COW）将普通用户提升为 Root。

### 5. 固件 (Firmware)

硬件的灵魂，也是最容易被忽视的。

- **S (欺骗)**：**降级攻击**。攻击者能不能强行刷入一个旧版本的、已知有漏洞的固件？
- **T (篡改)**：固件签名验证了吗？如果没有，攻击者可以刷入植入了木马的自制固件（APT 攻击常驻手段）。
- **D (DoS)**：在 OTA 升级过程中断电或干扰，让设备变砖。
- **E (提权)**：很多固件里藏着硬编码的默认密码（比如 `admin:password`），一旦提取出来就是通杀。

### 6. 物理设备 (The Physical Equipment)

这是 IoT 安全最独特的地方：黑客可以直接摸到设备。

- **S (欺骗)**：**供应链攻击**。在你买到设备之前，里面的芯片是不是已经被换过了？
- **T (篡改)**：**JTAG/UART 接口**。拆开机器，找到调试接口，直接读写内存。或者插入恶意 USB 设备（比如 Rubber Ducky）。
- **I (泄露)**：**冷启动攻击**。把内存条冷冻后拔下来，利用残留电荷读取其中的数据（包括加密密钥）。
- **D (DoS)**：最原始但有效的攻击——拔掉电源，或者物理破坏电路板。

---

## 五、 进阶玩法：攻击树 (Attack Trees)

STRIDE 帮我们做好了“体检清单”，但有时候我们需要更直观地看清攻击路径。这就需要用到**攻击树**。

攻击树以攻击者的**最终目标**为根节点，向下分叉出各种实现路径。

**目标：篡改药物输送**

<img
  src="/static/images/IOT/attack_tree_tampering.png"
  alt="Figure 2-5: Attack tree for the threat of tampering with drug delivery"
  width="700"
/>
*(图注：这棵树展示了黑客的思维路径。要达成“篡改药物输送”，可以选择“修改输液速率”或“破坏输液更新”。要“修改输液速率”，可以通过“篡改设备设置”或者“篡改数据库”。要“篡改数据库”，可以通过“SQL注入”或者“物理接触刷入恶意数据”。)*

**为什么用攻击树？**
STRIDE 帮你**广撒网**找到所有组件的弱点，而攻击树帮你**聚焦**，理清攻击者的逻辑链路，特别是那些需要多个步骤配合才能完成的复杂攻击（Chain Attacks）。

## 六、 总结

IoT 威胁建模通过对**架构**的拆解、**数据流**的分析，配合 **STRIDE** 模型和 **攻击树**，让我们能在黑客动手之前，就发现系统的脆弱点。

对于这个输液泵案例，我们不仅是在找 Bug，我们是在设计防御体系：

1.  物理接口（USB/JTAG）必须物理封死或逻辑禁用。
2.  通信必须全链路加密（HTTPS/TLS）并双向验证签名。
3.  数据库和 API 需要严格过滤输入，防止注入。
4.  系统需要做最小权限管理，不能让 App 拥有 Root 权限。

记住，**安全不是一个产品，而是一个过程**。威胁建模就是这个过程的第一步，也是最重要的一步。

**下一章预告：** 既然我们已经在纸面上分析透了，下一章我们将深入**漏洞分析（Vulnerability Research）**，看看如何真正挖掘出那些我们刚刚预测到的漏洞！

```python
# 课后思考题：
# 试着画出你家里的“智能扫地机器人”的攻击树。
# 根节点：偷窥你家的户型图。
# 子节点会有哪些？（提示：云端泄漏、Wi-Fi 抓包、拆解机器人读取 Flash...）
```
